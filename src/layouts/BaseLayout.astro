---
export interface Props {
  title?: string;
  description?: string;
  image?: string; // puede ser relativa (/images/og.jpg) o absoluta
  url?: string;   // si no se pasa, se genera con Astro.site + Astro.url
}

// Defaults seguros
const DEFAULTS = {
  title:
    'JOBBLY — Tu puerta a prácticas y trabajos para universitarios',
  description:
    'Encuentra prácticas, trabajos de medio tiempo y oportunidades por habilidades. Recomendaciones, chat con empleadores y notificaciones. Sin CV, perfil rápido.',
  // Deja tu logo por ahora; idealmente cambia a una OG 1200×630 JPG/PNG
  image: '/images/logo.png',
};

const props = Astro.props as Props;

const site = (Astro.site?.toString() ?? 'https://jobbly.app').replace(/\/$/, '');
const currentUrl = props.url ?? new URL(Astro.url.pathname, site).toString();

const title = props.title ?? DEFAULTS.title;
const description = props.description ?? DEFAULTS.description;
const rawImage = props.image ?? DEFAULTS.image;
// og:image absoluta
const ogImage = rawImage.startsWith('http')
  ? rawImage
  : new URL(rawImage, site).toString();

// logo absoluto para JSON-LD
const logoAbs = new URL('/images/logo.png', site).toString();

import "@styles/global.css";
---
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow, max-image-preview:large" />
    <meta name="theme-color" content="#0F172A" />
    <meta name="color-scheme" content="dark" />

    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="canonical" href={currentUrl} />

    <!-- Preconnect fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="JOBBLY" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={currentUrl} />
    <meta property="og:image" content={ogImage} />
    <!-- Si tu imagen es 1200x630, declara dimensiones para mejores previews -->
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <!-- JSON-LD: MobileApplication (sin ratings ficticios) -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "MobileApplication",
        "name": "JOBBLY",
        "url": site,
        "description": description,
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "iOS, Android",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "logo": logoAbs
      })}
    </script>

    <!-- Slot opcional para inyectar tags extra desde páginas -->
    <slot name="head" />
  </head>
  <body class="font-sans">
    <a
      href="#contenido"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 btn-ghost"
      >Saltar al contenido</a
    >
    <slot />
  </body>
</html>
